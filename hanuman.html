<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HANUMAN</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #0f172a; color: #e2e8f0; }
    .user-message {
      background: #2563eb;
      color: white;
      padding: 10px 14px;
      border-radius: 16px 16px 4px 16px;
      max-width: 70%;
      word-wrap: break-word;
    }
    .bot-message {
      background: #1e293b;
      color: #f8fafc;
      padding: 10px 14px;
      border-radius: 16px 16px 16px 4px;
      max-width: 70%;
      word-wrap: break-word;
    }
    .logo-img {
      width: 96px;
      height: 96px;
    }
    .typing-dots span {
      display: inline-block;
      width: 6px;
      height: 6px;
      margin: 0 2px;
      background: #94a3b8;
      border-radius: 50%;
      animation: bounce 1.3s infinite;
    }
    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }
  </style>
</head>
<body class="flex flex-col h-screen">
  <!-- Chat Container -->
  <div id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-4">
    <div class="flex justify-center items-center py-8 text-gray-400">
      <div class="text-center max-w-md">
        <img src="images (1).jpeg"
             alt="AI assistant character" class="mx-auto mb-4 rounded-full logo-img" />
        <p class="text-lg font-medium">HELLO  I'M HANUMAN <br />How can I help you today?</p>
        <p class="text-sm mt-2">Ask me anything or start a conversation!</p>
      </div>
    </div>
  </div>

  <!-- Typing Indicator -->
  <div id="typingIndicator" class="hidden px-4 pb-2 text-gray-400">
    <div class="flex items-center space-x-2">
<img src="images (1).jpeg" 
     alt="Hanuman AI Logo" 
     class="mx-auto mb-4 rounded-full" />
        <span></span><span></span><span></span>
      </div>
    </div>
  </div>

  <!-- Input -->
  <form id="messageForm" class="p-4 border-t border-gray-700 flex space-x-2">
    <input id="messageInput" type="text" placeholder="Type a message..."
           class="flex-1 px-4 py-2 rounded-lg bg-gray-800 text-gray-100 focus:outline-none" />
    <button class="px-4 py-2 bg-blue-600 text-white rounded-lg">Send</button>
  </form>

<script>
  const API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiMzFkNmNjMC1mMzFiLTRlMzQtOTczYy01ZDRkMmUyZmNmZjkiLCJlbWFpbCI6InJhanA5NTE0NkBnbWFpbC5jb20iLCJrZXlJZCI6IjVmY2MzMDFiLWI3ZWQtNGY3Ni04ZTIzLThmMDg4NzRhYjU1ZSIsInR5cGUiOiJhcGlfa2V5IiwiaWF0IjoxNzU1NTc0Njg5fQ.dGaDwk6HJnt2k7p_PM_NMXklre4Id1RDhYZV9GjYCQ4"; 
  const API_URL = "https://api.closerouter.com/v1/chat/completions";

  const chatContainer = document.getElementById("chatContainer");
  const messageForm = document.getElementById("messageForm");
  const messageInput = document.getElementById("messageInput");
  const typingIndicator = document.getElementById("typingIndicator");

  // Prompt history
  let promptHistory = JSON.parse(localStorage.getItem("promptHistory")) || [];
  let historyIndex = promptHistory.length;

  // Append message
  function appendMessage(sender, text) {
    const msgDiv = document.createElement("div");
    msgDiv.className = `flex ${sender === "user" ? "justify-end" : "justify-start"} items-start space-x-2`;

    if (sender === "bot") {
      const avatar = document.createElement("img");
      avatar.src = "images (1).jpeg";
      avatar.className = "w-6 h-6 rounded-full mt-1";
      msgDiv.appendChild(avatar);
    }

    const bubble = document.createElement("div");

    // 👇 Code detect karo
    const isCode = text.includes("```") || text.includes("<") || text.includes(";") || text.includes("{");
    
    if (isCode) {
      bubble.className = "bg-gray-900 text-green-400 font-mono text-sm p-3 rounded-lg whitespace-pre overflow-x-auto max-w-md";
      const cleanText = text.replace(/```[a-z]*/g, "").replace(/```/g, "");
      bubble.textContent = cleanText;
    } else {
      bubble.className = sender === "user" ? "user-message" : "bot-message";

      if (sender === "bot") {
        let i = 0;
        const typing = setInterval(() => {
          bubble.textContent += text.charAt(i);
          i++;
          if (i >= text.length) clearInterval(typing);
          chatContainer.scrollTop = chatContainer.scrollHeight;
        }, 35);
      } else {
        bubble.textContent = text;
      }
    }

    msgDiv.appendChild(bubble);
    chatContainer.appendChild(msgDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  // Handle special replies
  function customReplies(message) {
    const msg = message.toLowerCase();
    if (msg.includes("tumhe kisne banaya")) return "Mujhe Pritam ne banaya hai ❤️";
    if (msg.includes("instagram") || msg.includes("ig handle")) return "Mera creator ka Instagram 👉 @urfav_pritam";
    return null;
  }

  // Send message
  messageForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const userMessage = messageInput.value.trim();
    if (!userMessage) return;

    // Save prompt
    promptHistory.push(userMessage);
    localStorage.setItem("promptHistory", JSON.stringify(promptHistory));
    historyIndex = promptHistory.length;

    // Clear chat if "clear"
    if (userMessage.toLowerCase() === "clear") {
      chatContainer.innerHTML = `
        <div class="flex justify-center items-center py-8 text-gray-400">
          <div class="text-center max-w-md">
            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/29f4a461-705c-4dfe-bb0c-e68c4a216597.png"
                 alt="AI assistant character" class="mx-auto mb-4 rounded-full logo-img" />
            <p class="text-lg font-medium">How can I help you today?</p>
            <p class="text-sm mt-2">Ask me anything or start a conversation!</p>
          </div>
        </div>`;
      messageInput.value = "";
      return;
    }

    appendMessage("user", userMessage);
    messageInput.value = "";

    // Custom reply check
    const custom = customReplies(userMessage);
    if (custom) {
      appendMessage("bot", custom);
      return;
    }

    typingIndicator.classList.remove("hidden");

    try {
      const response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${API_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "gemini-2.0-flash-exp",
          messages: [
            { role: "system", content: "You are a helpful assistant." },
            { role: "user", content: userMessage }
          ]
        })
      });
      const data = await response.json();
      let reply = data?.choices?.[0]?.message?.content?.trim() || "⚠️ No response from AI.";

      typingIndicator.classList.add("hidden");
      appendMessage("bot", reply);
    } catch (err) {
      typingIndicator.classList.add("hidden");
      appendMessage("bot", "⚠️ Error connecting to server.");
    }
  });

  // Prompt history navigation
  messageInput.addEventListener("keydown", (e) => {
    if (e.key === "ArrowUp") {
      if (historyIndex > 0) {
        historyIndex--;
        messageInput.value = promptHistory[historyIndex] || "";
      }
    } else if (e.key === "ArrowDown") {
      if (historyIndex < promptHistory.length - 1) {
        historyIndex++;
        messageInput.value = promptHistory[historyIndex] || "";
      } else {
        historyIndex = promptHistory.length;
        messageInput.value = "";
      }
    }
  });
</script>
</body>
</html>